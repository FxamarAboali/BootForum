<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:pe="http://primefaces.org/ui/extensions"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    template="/WEB-INF/template/layout_admin.xhtml">

	<ui:define name="title">
		#{msg['email.management']}
	</ui:define>
	
	<ui:define name="content">

		<style type="text/css">
			
		</style>
		
		<!-- load data-->
		<f:metadata>
			<f:viewAction action="#{manageEmail.onLoad}"/>
		</f:metadata>
		
		<div class="w3-panel w3-card-4 w3-margin-top w3-padding w3-white" jsf:id="mainContentDiv">
			
			<div class="w3-panel w3-round w3-theme-dark w3-center w3-round">
 				<h3>#{msg['email.configuration']}</h3>
 			</div>
 			
 			<p:messages id="messages" showDetail="true" closable="true">
				<p:autoUpdate/>
			</p:messages>
			
			<h:form id="form" styleClass="w3-theme-light">
				<div class="w3-container w3-xlarge w3-border-bottom">
					Email Configuration
				</div>
				
				<div class="w3-row-padding">
				
					<div class="w3-half container">
						<p/>
						<p:outputLabel for="host" value="Host" styleClass="w3-medium" style="font-weight:bold;" indicateRequired="false"/>
						&nbsp;<i class="pi pi-question-circle w3-large" jsf:id="helpHost"/>
						<p:overlayPanel for="helpHost" style="width:240px" styleClass="w3-black">
							Host name for SMTP server.<br/>Example: <b>smtp.gmail.com</b>
						</p:overlayPanel>
						<p/>
						<p:inputText id="host" value="#{manageEmail.emailOption.host}" styleClass="w3-input" maxlength="80" 
							required="true" requiredMessage="#{msg['email.host.required']}"/>
						<h:message id="hostError" for="host" styleClass="w3-pale-red">
							<p:autoUpdate/>
						</h:message>
					</div>					

					<div class="w3-half container">
						<p/>
						<div class="w3-quarter container">
							
							<p:outputLabel for="port" value="Port" styleClass="w3-medium" style="font-weight:bold;" indicateRequired="false"/> 
							&nbsp;<i class="pi pi-question-circle w3-large" jsf:id="helpPort"/>
							<p:overlayPanel for="helpPort" style="width:240px" styleClass="w3-black">
								Port number for SMTP server.<br/>Example: <b>587</b>
							</p:overlayPanel>
							
							<p/>
							<p:inputText id="port" value="#{manageEmail.emailOption.port}" styleClass="w3-input" required="true" requiredMessage="#{msg['email.port.required']}">
								<p:keyFilter mask="num" />
								<f:validateLongRange minimum="1" maximum="65535"></f:validateLongRange>
							</p:inputText>
							<br/>
							<h:message id="portError" for="port" styleClass="w3-pale-red">
								<p:autoUpdate/>
							</h:message>
						</div>

						<div class="w3-half container w3-right-align">
							<p:outputLabel for="authentication" value="Authentication" styleClass="w3-medium" style="font-weight:bold;"/>
							&nbsp;<i class="pi pi-question-circle w3-large" jsf:id="helpAuthentication"/>
							<p:overlayPanel for="helpAuthentication" style="width:240px" styleClass="w3-black w3-left-align">
								Whether email server uses authentication
							</p:overlayPanel>
							<p/>
							<p:selectBooleanCheckbox id="authentication" value="#{manageEmail.emailOption.authentication}"/>
						</div>
	
						<div class="w3-quarter container w3-right-align">
							<p:outputLabel for="tls" value="TLS" styleClass="w3-medium" style="font-weight:bold;"/>
							&nbsp;<i class="pi pi-question-circle w3-large" jsf:id="helpTLS"/>
							<p:overlayPanel for="helpTLS" style="width:240px" styleClass="w3-black w3-left-align">
								Whether email server uses TLS
							</p:overlayPanel>
							<p/>
							<p:selectBooleanCheckbox id="tls" value="#{manageEmail.emailOption.tlsEnable}"/>
						</div>
					</div>
														
					<div class="w3-half container">
						
						<p:outputLabel for="username" value="Username" styleClass="w3-medium" style="font-weight:bold;" indicateRequired="false"/>
						&nbsp;<i class="pi pi-question-circle w3-large" jsf:id="helpUsername"/>
						<p:overlayPanel for="helpUsername" style="width:240px" styleClass="w3-black">
							Username to login SMTP server
						</p:overlayPanel>
						<p/>
						<p:inputText id="username" value="#{manageEmail.emailOption.username}" styleClass="w3-input" maxlength="80" 
							required="true" requiredMessage="#{msg['email.username.required']}"/>
						<h:message id="usernameError" for="username" styleClass="w3-pale-red">
							<p:autoUpdate/>
						</h:message>
					</div>
					
					<div class="w3-half container">
						<p:outputLabel for="username" value="Password" styleClass="w3-medium" style="font-weight:bold;" indicateRequired="false"/>
						&nbsp;<i class="pi pi-question-circle w3-large" jsf:id="helpPassword"/>
						<p:overlayPanel for="helpPassword" style="width:240px" styleClass="w3-black">
							Password to login SMTP server
						</p:overlayPanel>
						<p/>
						<p:password id="password" value="#{manageEmail.emailOption.password}" styleClass="w3-input" maxlength="80" 
							required="true" requiredMessage="#{msg['email.password.required']}" redisplay="true"/>
						<h:message id="passwordError" for="password" styleClass="w3-pale-red">
							<p:autoUpdate/>
						</h:message>
					</div>

					<div class="w3-threequarter container w3-margin-top">
						<!-- Note: to invoke the remoteCommand as below, type=button is important for it to work properly -->
						<p:commandButton value="#{msg['save']}" type="button" icon="pi pi-check" onclick="submitForm();"
							styleClass="w3-btn w3-theme-dark w3-border-0"/>
						
						<span class="w3-margin-left" onclick="$('#form\\:testConfigurationDiv').toggle();"
							style="cursor:pointer;color:purple;font-weight:bold;">
							Test Configuration
						</span>
						&nbsp;<i class="pi pi-question-circle w3-large" jsf:id="helpTestConfiguration"/>
						<p:overlayPanel for="helpTestConfiguration" style="width:240px" styleClass="w3-black w3-left-align">
							Send a test email to validate the configuration
						</p:overlayPanel>
					</div>                	
					
				</div>
				
				<p:remoteCommand name="submitForm" action="#{manageEmail.save}"/>

				<p/>
				
				<div jsf:id="testConfigurationDiv" class="w3-container w3-border-top w3-animate-top">
					
					<div class="w3-panel w3-border w3-round w3-display-container">
					
						<span onclick="$('#form\\:testConfigurationDiv').hide();" class="w3-button w3-display-topright w3-grey w3-theme-dark">X</span>
						
						<br/><br/>
						
						<div class="w3-panel w3-pale-blue w3-leftbar w3-border-blue w3-margin-top">
							<p>
							Enter the input fields below to test email configuration. If configuration are OK, an email will be sent to the "To Email".
							</p>
						</div>
						
						<div jsf:id="testResultDiv" class="w3-card w3-container w3-margin-top">
							
							<h4><b>Test Result:</b></h4>
							<h4 jsf:rendered="#{manageEmail.testRan and manageEmail.testSuccess}" class="w3-green"> Test Email Sent</h4>
							<h4 jsf:rendered="#{manageEmail.testRan and not manageEmail.testSuccess}" class="w3-red"> Failed</h4>
						</div>
						
						<p/>
						
						<div class="w3-row-padding container">
							
							<p:outputLabel for="testToEmail" value="To Email" styleClass="w3-medium" style="font-weight:bold;" indicateRequired="false"/>
							<br/>
							<p:inputText id="testToEmail" value="#{manageEmail.testToEmail}" styleClass="w3-input"
								maxlength="80" required="true" requiredMessage="Must specify 'To Email'"/>
							<h:message id="testToEmailError" for="testToEmail" styleClass="w3-pale-red">
								<p:autoUpdate/>
							</h:message>
							
							<p/>
							<p:outputLabel for="testEmailSubject" value="Email Subject" styleClass="w3-medium" style="font-weight:bold;" indicateRequired="false"/>
							<br/>
							<p:inputText id="testEmailSubject" value="#{manageEmail.testEmailSubject}" styleClass="w3-input"
								maxlength="100" required="true" requiredMessage="Must specify 'Test Email Subject'"/>
							<h:message id="testEmailSubjectError" for="testEmailSubject" styleClass="w3-pale-red">
								<p:autoUpdate/>
							</h:message>
							
							<p/>
							<p:outputLabel for="testEmailContent" value="Email Content" styleClass="w3-medium" style="font-weight:bold;" indicateRequired="false"/>
							<br/>
							
							<!-- 
								Design decision: use pe:ckEditor or p:textEditor?
								
									Both will have issue loading in a <div> element that is initially have 'display:none'
									So must start without the 'display:none', then use $(document).ready(){ } callback to hide the <div>
									
										ckEditor has issue 
							 -->	 
							 					
							<!-- <pe:ckEditor id="testEmailContent" value="#{manageEmail.testEmailContent}" skin="moono-lisa" width="100%" required="true"
								toolbar="[['Bold', 'Italic', 'Underline', 'Strike', '-', 'Styles', 'Format', 'Font', 'FontSize', '-', 'TextColor', 'BGColor']]" 
										requiredMessage="Test email content is required">
							</pe:ckEditor> -->
							
							<!-- 
								javax.faces.FacesException: TextEditor component is marked secure='true' but the HTML Sanitizer was not found on the classpath. 
									Either add the HTML sanitizer to the classpath per the documentation or mark secure='false' if you would like to use the component
									without the sanitizer.
							 -->
							<p:textEditor id="testEmailContent" value="#{manageEmail.testEmailContent}" widgetVar="testEmailContentVar" 
								height="250" secure="false" required="true" requiredMessage="Test email content is required"/>
							<h:message id="testEmailContentError" for="testEmailContent" styleClass="w3-pale-red">
								<p:autoUpdate/>
							</h:message>
							
							<p/>
							<p:commandButton value="Send Test Email" action="#{manageEmail.testEmailConfiguration}" ajax="true" icon="pi pi-send" update="testResultDiv"
								styleClass="w3-btn w3-theme-dark w3-border-0"/>				
							<p/>
						</div>
						
					</div>
					
				</div>
				
			</h:form>		
		
 		</div>
 		
		<script>
			//<![CDATA[//------
			
			/* hide the testConfigurationDiv after the page loaded */
			$(document).ready(function() {
				$('#form\\:testConfigurationDiv').toggle();
			});	
			//]]>
		</script>
				
	</ui:define>
	
</ui:composition>