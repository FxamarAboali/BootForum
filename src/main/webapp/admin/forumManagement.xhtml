<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
    template="/WEB-INF/template/layout_admin.xhtml">

	<ui:define name="title">
		#{msg['application.title']} - Forums Management
	</ui:define>
	
	<ui:define name="content">
		
		<!-- set request parameter values from URL to backing bean -->
		<f:metadata>
			<f:viewParam name="forumGroupId" value="#{forumManagement.forumGroupId}"/>
			<f:viewAction action="#{forumManagement.onLoad}"/>
		</f:metadata>
		
		<div class="w3-panel w3-card-4 w3-margin-top w3-padding w3-white" jsf:id="mainContentDiv">
		
			<p:messages id="messages" showDetail="true">
				<p:autoUpdate/>
			</p:messages>
			
			<div class="w3-panel w3-round w3-theme-d5 w3-center w3-round">
 				<h2>#{msg['forumManagement.page.title']}</h2>
 			</div>
 			
 			<h:form id="breadCrumbForm">
				
				<p:breadCrumb>
					
					<!-- home/root ForumGroup -->
					<p:menuitem value="Home" url="forumManagement.xhtml"/>
					
					<c:forEach items="#{forumManagement.breadCrumb}" var="forumGroup">
						<p:menuitem value="#{forumGroup.title}" url="?forumGroupId=#{forumGroup.id}"/>
					</c:forEach>
				</p:breadCrumb>
			</h:form>			
			
			<div class="w3-panel w3-border w3-round w3-display-container">
				
				<div jsf:id="editForumGroupContentDiv">
									
					<div jsf:id="forumGroupIconDiv" class="w3-section w3-center">
						
						<div class="w3-padding-16" style="margin:auto;max-width:450px;color:white;background-color: ##{empty forumManagement.forumGroup ? '808080' : forumManagement.forumGroup.iconColor}">
							
					        <div class="w3-center">
					        	<h5>Forum Group</h5>
					        	<p/>
					        	<i class="#{empty forumManagement.forumGroup ? 'fa fa-home' : forumManagement.forumGroup.icon} fa-5x"/>
					        	<p/>
					        	<h3>#{empty forumManagement.forumGroup ? 'Home' : forumManagement.forumGroup.title}</h3>
					        </div>
					    </div>
												
					</div>
					
					<p/>
					
					<div class="w3-center">

						<button jsf:rendered="#{not empty forumManagement.forumGroup}" class="w3-button w3-left-align w3-border"
							onclick="$('.formDiv').hide();$('#editForumGroupDiv').show();return false;">
							<i class="fa fa-edit"/> #{msg['forumManagement.page.editForumInfo']}
						</button>

						<button onclick="$('.formDiv').hide();$('#newForumDiv').show();return false;" class="w3-button w3-left-align w3-border">
							<i class="fa fa-list-alt"/>
							Add New Forum
						</button>
						<button onclick="$('.formDiv').hide();$('#newForumGroupDiv').show();return false;" class="w3-button w3-left-align w3-border">
							<i class="fa fa-th-list"/>
							Add Sub Forum Group
						</button>
					
					</div>

					<p/>					
					
					<div id="editForumGroupDiv" class="formDiv w3-panel w3-round w3-border w3-display-container w3-animate-right" 
						jsf:rendered="#{not empty forumManagement.forumGroup}" style="display:none">
						<span onclick="this.parentElement.style.display='none'" class="w3-button w3-display-topright">X</span>
						
						<p>&#160;</p>
						
						<h:form>
							<div class="w3-row-padding" style="margin:0 -16px;"> <!-- responsive -->
							
								<div class="w3-col m4 l3">
									<h:outputText value="#{msg['forumManagement.createForumGroup.form.title']}:"/>
								</div>
								<div class="w3-col m8 l9">
					  				<p:inputText value="#{forumManagement.forumGroup.title}" validatorMessage="Forum Group Title is required" style="width:100%;">
					  					<f:validateLength  minimum="1" maximum="255"/>
					  				</p:inputText>
					  			</div>
					  			
					  			<div class="w3-row w3-section"/> <!-- vertical spacer -->
					  			
					  			<div class="w3-col m4 l3">		
					  				<h:outputText value="#{msg['forumManagement.createForumGroup.form.icon']}:"/>
					  			</div>
					  			<div class="w3-col m8 l9">
					  				<p:selectOneMenu value="#{forumManagement.forumGroup.icon}" panelStyle="width:250px" style="width:270px;"
					  					effect="fade" filter="true" filterMatchMode="startsWith" filterPlaceholder="search" var="f">
					  					<f:selectItems value="#{fontAwesomes.list}" var="font" itemLabel="#{font}" itemValue="fa fa-#{font}"/>
					  					
						  				<p:column style="width:10%">
						  					<i class="#{f} fa-2x"/>
						  				</p:column>
						  				
						  				<p:column>
						  					<h:outputText value="#{f}"/>
						  				</p:column>
					  					
					  				</p:selectOneMenu>
			  				
					  			</div>
					  			
					  			<div class="w3-row w3-section"/> <!-- vertical spacer -->
					  			
					  			<div class="w3-col m4 l3">	
					  				<h:outputText value="#{msg['forumManagement.createForumGroup.form.iconColor']}:"/>
					  			</div>
					  			<div class="w3-col m8 l9">
					  				<p:colorPicker value="#{forumManagement.forumGroup.iconColor}" mode="inline" />
				  				</div>
				  			
				  				<div class="w3-row w3-section"/> <!-- vertical spacer -->
				  			
				  				<div class="w3-row">
					  				<p:commandButton id="editForumGroup" ajax="true" action="#{forumManagement.editForumGroup}"
						            	value="#{msg['userAction.save']}" update=":messages :breadCrumbForm :forumGroupIconDiv"
						            	icon="fa fa-save" style="margin-top: 5px;"/>
						            <p:commandButton type="button" onclick="document.getElementById('editForumGroupDiv').style.display='none';" 
						            	value="#{msg['userAction.cancel']}" icon="fa fa-close" style="margin-left:5px;"/>
				  				</div>	
				  				
			  				</div>
		  				</h:form>
		  				
		  				<p/>
					</div>
				
				</div> <!-- end editForumGroupContentDiv -->
				
				<div id="newForumDiv" class="formDiv w3-panel w3-border w3-display-container w3-animate-right" style="display:none">
					<span onclick="this.parentElement.style.display='none'" class="w3-button w3-display-topright">X</span>
					
					<h4>#{msg['forumManagement.createForum.dialog.title']}</h4>
					
					<div class="w3-row w3-section"/> <!-- vertical spacer -->
					
					<h:form>
						<div class="w3-row-padding" style="margin:0 -16px;"> <!-- responsive -->
						
							<div class="w3-col m4 l3">
								<h:outputText value="#{msg['forumManagement.createForum.form.title']}:"/>
							</div>
							<div class="w3-col m8 l9">
				  				<p:inputText value="#{forumManagement.newForum.title}" validatorMessage="Forum Title is Required" style="width:100%;">
				  					<f:validateLength  minimum="1" maximum="255"/>
				  				</p:inputText>
				  			</div>
				  			
				  			<div class="w3-row w3-section"/> <!-- vertical spacer -->
				  			
				  			<div class="w3-col m4 l3">		
				  				<h:outputText value="#{msg['forumManagement.createForum.form.icon']}:"/>
				  			</div>
				  			<div class="w3-col m8 l9">
				  				<p:selectOneMenu value="#{forumManagement.newForum.icon}" panelStyle="width:250px" style="width:270px;"
				  					effect="fade" filter="true" filterMatchMode="startsWith" filterPlaceholder="search" var="f">
				  					<f:selectItems value="#{fontAwesomes.list}" var="font" itemLabel="#{font}" itemValue="fa fa-#{font}"/>
				  					
					  				<p:column style="width:10%">
					  					<i class="#{f} fa-2x"/>
					  				</p:column>
					  				
					  				<p:column>
					  					<h:outputText value="#{f}"/>
					  				</p:column>
				  					
				  				</p:selectOneMenu>
		  				
				  			</div>
				  			
				  			<div class="w3-row w3-section"/> <!-- vertical spacer -->
				  			
				  			<div class="w3-col m4 l3">	
				  				<h:outputText value="#{msg['forumManagement.createForum.form.iconColor']}:"/>
				  			</div>
				  			<div class="w3-col m8 l9">
				  				<p:colorPicker value="#{forumManagement.newForum.iconColor}" mode="inline" />
			  				</div>
			  				
			  				<div class="w3-row w3-section"/> <!-- vertical spacer -->
			  				
			  				<div class="w3-row">
				  				<p:commandButton id="createForum" ajax="true" action="#{forumManagement.createForum}"
					            	value="Submit" update=":forumContentDiv :messages" oncomplete="window.scrollTo(0,0)"
					            	icon="fa fa-plus" style="margin-top: 5px;"/>
					            <p:commandButton type="button" onclick="document.getElementById('newForumDiv').style.display='none';" value="Cancel"
	            					icon="fa fa-close" style="margin-left:5px;"/>	
			  				</div>	
			  				
		  				</div>
	  				</h:form>
	  				
	  				<p/>
				</div> <!-- end newForumDiv -->
				
				<div id="newForumGroupDiv" class="formDiv w3-panel w3-round w3-border w3-display-container w3-animate-right" style="display:none">
					<span onclick="this.parentElement.style.display='none'" class="w3-button w3-display-topright">X</span>
					
					<h4>#{msg['forumManagement.createForumGroup.dialog.title']}</h4>
					
					<div class="w3-row w3-section"/> <!-- vertical spacer -->
					
					<h:form>
						<div class="w3-row-padding" style="margin:0 -16px;"> <!-- responsive -->
						
							<div class="w3-col m4 l3">
								<h:outputText value="#{msg['forumManagement.createForumGroup.form.title']}:"/>
							</div>
							<div class="w3-col m8 l9">
				  				<p:inputText value="#{forumManagement.newForumGroup.title}" validatorMessage="Forum Group Title is required" style="width:100%;">
				  					<f:validateLength  minimum="1" maximum="255"/>
				  				</p:inputText>
				  			</div>
				  			
				  			<div class="w3-row w3-section"/> <!-- vertical spacer -->
				  			
				  			<div class="w3-col m4 l3">		
				  				<h:outputText value="#{msg['forumManagement.createForumGroup.form.icon']}:"/>
				  			</div>
				  			<div class="w3-col m8 l9">
				  				<p:selectOneMenu value="#{forumManagement.newForumGroup.icon}" panelStyle="width:250px" style="width:270px;"
				  					effect="fade" filter="true" filterMatchMode="startsWith" filterPlaceholder="search" var="f">
				  					<f:selectItems value="#{fontAwesomes.list}" var="font" itemLabel="#{font}" itemValue="fa fa-#{font}"/>
				  					
					  				<p:column style="width:10%">
					  					<i class="#{f} fa-2x"/>
					  				</p:column>
					  				
					  				<p:column>
					  					<h:outputText value="#{f}"/>
					  				</p:column>
				  					
				  				</p:selectOneMenu>
		  				
				  			</div>
				  			
				  			<div class="w3-row w3-section"/> <!-- vertical spacer -->
				  			
				  			<div class="w3-col m4 l3">	
				  				<h:outputText value="#{msg['forumManagement.createForumGroup.form.iconColor']}:"/>
				  			</div>
				  			<div class="w3-col m8 l9">
				  				<p:colorPicker value="#{forumManagement.newForumGroup.iconColor}" mode="inline" />
			  				</div>
			  				
			  				<div class="w3-row w3-section"/> <!-- vertical spacer -->
			  				
			  				<div class="w3-row">

				  				<p:commandButton id="createForumGroup" ajax="true" action="#{forumManagement.createForumGroup}"
					            	value="Submit" update=":forumGroupContentDiv :messages" oncomplete="window.scrollTo(0,0)"
					            	icon="fa fa-plus" style="margin-top: 5px;"/>
					            <p:commandButton type="button" onclick="document.getElementById('newForumGroupDiv').style.display='none';" value="Cancel"
	            					icon="fa fa-close" style="margin-left:5px;"/>
		            			
			  				</div>	
			  				
		  				</div>
	  				</h:form>
	  				
	  				<p/>
				</div> <!-- end newForumGroupDiv -->

				<!-- edit Forum div -->
				<div jsf:id="editForumDiv" class="formDiv w3-panel w3-border w3-display-container w3-animate-right" style="display:none">
						
					<span onclick="this.parentElement.style.display='none'" class="w3-button w3-display-topright">X</span>
										
					<h3 class="w3-opacity" jsf:id="forumHeading" jsf:rendered="#{not empty forumManagement.selectedForum}">Edit Forum <b>#{forumManagement.selectedForum.title}</b></h3>
					
					<p>&#160;</p>
					
					<div jsf:id="forumIconDiv" class="w3-center" jsf:rendered="#{not empty forumManagement.selectedForum}">
						<span class="w3-tag w3-xlarge w3-white w3-border w3-border-grey">
							<i class="#{forumManagement.selectedForum.icon} fa-5x" style="color:##{forumManagement.selectedForum.iconColor}"/>
						</span>
					</div>					
					
					<p>&#160;</p>
					
					<h:form rendered="#{not empty forumManagement.selectedForum}">
						<div class="w3-row-padding" style="margin:0 -16px;"> <!-- responsive -->
						
							<div class="w3-col m4 l3">
								<h:outputText value="#{msg['forumManagement.createForum.form.title']}:"/>
							</div>
							<div class="w3-col m8 l9">
				  				<p:inputText value="#{forumManagement.selectedForum.title}" validatorMessage="Forum Title is required" style="width:100%;">
				  					<f:validateLength  minimum="1" maximum="255"/>
				  				</p:inputText>
				  			</div>
				  			
				  			<div class="w3-row w3-section"/> <!-- vertical spacer -->
				  			
				  			<div class="w3-col m4 l3">		
				  				<h:outputText value="#{msg['forumManagement.createForum.form.icon']}:"/>
				  			</div>
				  			<div class="w3-col m8 l9">
				  				<p:selectOneMenu value="#{forumManagement.selectedForum.icon}" panelStyle="width:250px" style="width:270px;"
				  					effect="fade" filter="true" filterMatchMode="startsWith" filterPlaceholder="search" var="f">
				  					<f:selectItems value="#{fontAwesomes.list}" var="font" itemLabel="#{font}" itemValue="fa fa-#{font}"/>
				  					
					  				<p:column style="width:10%">
					  					<i class="#{f} fa-2x"/>
					  				</p:column>
					  				
					  				<p:column>
					  					<h:outputText value="#{f}"/>
					  				</p:column>
				  					
				  				</p:selectOneMenu>
		  				
				  			</div>
				  			
				  			<div class="w3-row w3-section"/> <!-- vertical spacer -->
				  			
				  			<div class="w3-col m4 l3">	
				  				<h:outputText value="#{msg['forumManagement.createForum.form.iconColor']}:"/>
				  			</div>
				  			<div class="w3-col m8 l9">
				  				<p:colorPicker value="#{forumManagement.selectedForum.iconColor}" mode="inline" />
			  				</div>
			  				
			  				<div class="w3-row w3-section"/> <!-- vertical spacer -->
			  				
			  				<div class="w3-col m4 l3">	
				  				<h:outputText value="#{msg['forumManagement.createForum.form.active']}:"/>
				  			</div>
				  			<div class="w3-col m8 l9">
				  				<p:selectBooleanCheckbox value="#{forumManagement.selectedForum.active}"/>
			  				</div>
			  			
			  				<p>&#160;</p>
			  			
			  				<div class="w3-row">
				  				<p:commandButton id="editForum" ajax="true" action="#{forumManagement.editForum}"
					            	value="#{msg['userAction.save']}" update=":messages :forumContentDiv" oncomplete="document.getElementById('editForumDiv').style.display='none';window.scrollTo(0,0);"
					            	icon="fa fa-save" style="margin-top: 5px;"/>
					            <p:commandButton type="button" value="#{msg['userAction.cancel']}" icon="fa fa-close" style="margin-left:5px;"
					            	onclick="document.getElementById('editForumDiv').style.display='none';
					            			document.getElementById('forumContentDiv').style.display='flex';"/>
			  				</div>	
			  				
		  				</div>
	  				</h:form>
	  				
	  				<p/>					
				
				</div> <!-- end editForumDiv -->


				
				<hr/>
									
				<h4 class="w3-opacity">Sub Forum Groups:</h4>
				
				<!-- 
					Display list of sub forum groups in the flow layout and responsive manner 
					Note: to achieve the flowlayout behavior, use the 'display:flex' and 'flex-wrap:wrap'
				 -->
				
				<div jsf:id="forumGroupContentDiv" style="display:flex;flex-wrap:wrap;" class="w3-padding-large">
					<p:repeat var="forumGroup" value="#{forumManagement.forumGroups}">
					
						<div class="w3-center w3-padding-large">
						
							<div class="w3-tooltip">
								
								<i class="#{forumGroup.icon} fa-5x" title="#{forumGroup.title}" style="color:##{forumGroup.iconColor}"/>
																
								<!-- Note: use 'min-width:150px', 'max-width: 180px' and 'width:auto' to control the min/max width for each entry -->
								<h5 class="w3-text-theme" style="min-width: 150px;max-width: 180px;width: auto;">#{forumGroup.title}</h5>
								
								<span class="w3-text">
									
									<!-- link to same page with param forumGroupId -->
									<p:linkButton icon="fa fa-eye" styleClass="w3-button" title="Edit this Forum Group" value=" View"> 
										<f:param name="forumGroupId" value="#{forumGroup.id}"/>
									</p:linkButton>
									
									<p:commandButton ajax="true" icon="fa fa-trash" styleClass="w3-button" style="margin-left:5px;"
										oncomplete="PF('deleteForumGroupConfirmation').show();" title="Delete this Forum Group" value="#{msg['userAction.delete']}">
										<f:setPropertyActionListener value="#{forumGroup}" target="#{forumManagement.selectedForumGroup}" />  
									</p:commandButton>
								</span>
							</div>
						</div>
						
					</p:repeat>
					
					<h5 jsf:rendered="#{empty forumManagement.forumGroups}" class="w3-text-theme"><b>No Sub Forum Group</b></h5>
					
				</div>
				
				<hr/>
				
				<h4 class="w3-opacity">Forums:</h4>

				<div jsf:id="forumContentDiv" style="display:flex;flex-wrap:wrap;" class="w3-padding-large">
				
					<p:repeat var="forum" value="#{forumManagement.forums}">
					
						<div class="w3-center w3-padding-large">
						
							<div class="w3-tooltip">
							
								<i class="#{forum.icon} fa-5x" title="#{forum.title}" style="color:##{forum.iconColor}"/>
								
								<h5 class="w3-text-theme" style="min-width: 150px;max-width: 180px;width: auto;">#{forum.title}</h5>
								
								<span class="w3-text">
								
									<!-- <p:commandButton ajax="true" icon="fa fa-edit" styleClass="w3-button" update=":editForumDiv"
										oncomplete="$('.formDiv').hide();$('#editForumDiv').show();document.getElementById('editForumDiv').scrollIntoView();" 
										title="Edit this Forum" value="#{msg['userAction.edit']}">
										<f:setPropertyActionListener value="#{forum}" target="#{forumManagement.selectedForum}"/>
									</p:commandButton>
									
									<p:commandButton ajax="true" icon="fa fa-trash" styleClass="w3-button" value="#{msg['userAction.delete']}"
										oncomplete="PF('deleteForumConfirmation').show();" title="Delete this Forum" style="margin-left:5px;">
										<f:setPropertyActionListener value="#{forum}" target="#{forumManagement.selectedForum}" />  
									</p:commandButton> -->
									
									
									<button onclick="editForumRC();return false;" class="w3-button w3-left-align w3-border">
										<i class="fa fa-edit"/>
										#{msg['userAction.edit']}
									</button>
									
									<button onclick="deleteForumRC();return false;" class="w3-button w3-left-align w3-border">
										<i class="fa fa-trash"/>
										#{msg['userAction.delete']}
									</button>
									
									<p:remoteCommand name="editForumRC" update=":editForumDiv" oncomplete="$('.formDiv').hide();$('#editForumDiv').show();document.getElementById('editForumDiv').scrollIntoView();">
										<f:setPropertyActionListener value="#{forum}" target="#{forumManagement.selectedForum}"/>
									</p:remoteCommand>
									
									<p:remoteCommand name="deleteForumRC" oncomplete="PF('deleteForumConfirmation').show();">
										<f:setPropertyActionListener value="#{forum}" target="#{forumManagement.selectedForum}"/>
									</p:remoteCommand>
									
								</span>	
							</div>
							
						</div>
						
					</p:repeat>
					
					<h5 jsf:rendered="#{empty forumManagement.forums}" class="w3-text-theme"><b>No Forum</b></h5>
					
				</div> <!-- end forumContentDiv -->
				
			</div>

			<p:confirmDialog message="Delete Forum Group and All Sub Groups, associated Forums, and Discussions?" showEffect="fade" hideEffect="fade"  
		        header="Confirm" severity="alert" widgetVar="deleteForumGroupConfirmation">
		  		<h:form>
			        <p:commandButton value="Yes" icon="fa fa-check"
			        	update=":forumGroupContentDiv :messages"  
			        	actionListener="#{forumManagement.deleteForumGroup}"
			        	oncomplete="PF('deleteForumGroupConfirmation').hide()"/>  
			        <p:commandButton value="Cancel" oncomplete="PF('deleteForumGroupConfirmation').hide();window.scrollTo(0,0);"
			        	icon="fa fa-close" style="margin-left:5px;">
			        	<f:setPropertyActionListener value="#{null}" target="#{forumManagement.selectedForumGroup}" />
			        </p:commandButton>  
		  		</h:form>
		    </p:confirmDialog>

			<p:confirmDialog message="Delete Forum and associated discussions?" showEffect="fade" hideEffect="fade"  
		        header="Confirm" severity="alert" widgetVar="deleteForumConfirmation" responsive="true">
		  		<h:form>
			        <p:commandButton value="Yes" icon="fa fa-check"
			        	update=":forumContentDiv :messages"  
			        	actionListener="#{forumManagement.deleteForum}"
			        	oncomplete="PF('deleteForumConfirmation').hide();window.scrollTo(0,0);"/>  
			        <p:commandButton value="Cancel" oncomplete="PF('deleteForumConfirmation').hide();"
			        	icon="fa fa-close" style="margin-left:5px;">
			        	<f:setPropertyActionListener value="#{null}" target="#{forumManagement.selectedForum}" />
			        </p:commandButton>  
		  		</h:form>
		    </p:confirmDialog>

		</div> <!-- end mainContentDiv -->

	</ui:define>
	
</ui:composition>