<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:pe="http://primefaces.org/ui/extensions"
    xmlns:fn="http://java.sun.com/jsp/jstl/functions"
    template="/WEB-INF/template/layout_admin.xhtml">

	<ui:define name="title">
		#{msg['application.title']} - #{msg['system.information']}
	</ui:define>
	
	<ui:define name="content">
	
		<style type="text/css">	
			 
			 /* borderless datatable: https://stackoverflow.com/questions/18880208/remove-all-borders-on-a-specific-datatable */
			
			.ui-datatable.borderless thead th,
			.ui-datatable.borderless tbody,
			.ui-datatable.borderless tbody tr,
			.ui-datatable.borderless tbody td {
			    border-style: none;
			}
			
			body .ui-paginator {
				 border-style: none;
			}
			
			.companyHeaderGrid.ui-panelgrid>*>tr,
				.companyHeaderGrid.ui-panelgrid .ui-panelgrid-cell {
				    border: none;
			}
			
		</style>

		<script type="text/javascript">
 			//<![CDATA[	
 				
 				/* set table header's background color */
 				$(document).ready(function(){
					document.querySelectorAll('.ui-datatable.borderless thead th').forEach(function(el) {el.className += ' w3-theme-l3'});
 				});
 				
			//]]>	
		</script>
		
		<div class="w3-panel w3-card-4 w3-margin-top w3-padding w3-white">

			<!-- <p:messages id="messages" showDetail="true">
				<p:autoUpdate/>
			</p:messages> -->
			
			<p/>

			<div class="w3-panel w3-theme-d5 w3-center w3-round">
 				<h3 id="title"><b>#{msg['system.information']}</b></h3>
 			</div>
		
			<p:fieldset id="systemStatistics" legend="#{msg['system.statistics']}" toggleable="true">
			
				<h:form id="systemStatForm">
			
			    	<p:panelGrid style="width:100%;">

						<p:row styleClass="ui-widget-content ui-datatable-odd">
							<p:column style="width:50%;">
								<h:outputText value="#{msg['comments']}" />
							</p:column>
							<p:column style="font-weight:bold" >
								<h:outputText value="#{systemInfo.statistics.commentCount}"/>
							</p:column>
						</p:row>

						<p:row styleClass="ui-widget-content ui-datatable-even">
							<p:column>
								<h:outputText value="#{msg['discussions']}" />
							</p:column>
							<p:column style="font-weight:bold">
								<h:outputText value="#{systemInfo.statistics.discussionCount}"/>
							</p:column>
						</p:row>


						<p:row styleClass="ui-widget-content ui-datatable-odd">
							<p:column>
								<h:outputText value="#{msg['forums']}" />
							</p:column>
							<p:column style="font-weight:bold">
								<h:outputText value="#{systemInfo.statistics.forumCount}"/>
							</p:column>
						</p:row>

						<p:row styleClass="ui-widget-content ui-datatable-even">
							<p:column>
								<h:outputText value="#{msg['forum.groups']}" />
							</p:column>
							<p:column style="font-weight:bold">
								<h:outputText value="#{systemInfo.statistics.forumGroupCount}"/>
							</p:column>
						</p:row>

						<p:row styleClass="ui-widget-content ui-datatable-odd">
							<p:column>
								<h:outputText value="#{msg['registered.users']}" />
							</p:column>
							<p:column style="font-weight:bold">
								<h:outputText value="#{systemInfo.statistics.userCount}"/>
							</p:column>
						</p:row>

						<p:row styleClass="ui-widget-content ui-datatable-even">
							
							<p:column>
								<h:outputText value="#{msg['last.registered.user']}" />
							</p:column>
							
							<p:column>
								<h:outputText value="#{systemInfo.statistics.lastRegisteredUser} "  style="font-weight:bold;"/>
								<pe:timeAgo	value="#{systemInfo.statistics.lastUserRegisteredDate}"/>
							</p:column>
							
						</p:row>

						<p:row styleClass="ui-widget-content ui-datatable-odd">
							
							<p:column>
								<h:outputText value="#{msg['last.comment']}" />
							</p:column>
							
							<p:column>
								<h:outputText value="By #{systemInfo.statistics.lastComment.updateBy} " style="font-weight:bold"/>
								<pe:timeAgo	value="#{systemInfo.statistics.lastComment.updateDate}"/>
							</p:column>
						</p:row>


						<p:row styleClass="ui-widget-content ui-datatable-even">
							<p:column>
								<h:outputText value="#{msg['logged.on.users']}" />
							</p:column>
							<p:column style="font-weight:bold">
								<h:outputText value="#{fn:length(systemInfo.loggedOnUsers)}" />
							</p:column>
						</p:row>

						<p:row styleClass="ui-widget-content ui-datatable-odd">
						
							<p:column>
								<h:outputText value="#{msg['anonymous.users']}" />
							</p:column>
							<p:column style="font-weight:bold">
								<h:outputText value="#{systemInfo.sessionCount - fn:length(systemInfo.loggedOnUsers)}"/>
							</p:column>
							
						</p:row>

					</p:panelGrid>
		    		
		    		<p/>
		    		
		    		<h:panelGrid columns="2"> <!-- use h:panelGrid to make the buttons row responsive -->
			    		<p:commandButton action="#{systemInfo.synchSystemStat}" icon="pi pi-refresh" id="synchSystemStatButton" styleClass="ui-button-raised ui-button-flat"
			    			value="#{msg['synchronize.system.statistics']}" update=":systemStatForm" widgetVar="synchSystemStatVar"
			    			onclick="$(this).children('span').eq(0).addClass('pi-spin pi-spinner');PF('synchSystemStatVar').disable();"
							oncomplete="$(this).children('span').eq(0).removeClass('pi-spin pi-spinner');PF('synchSystemStatVar').enable();">
						
							<p:confirm type="popup" header="Confirmation" message="Are you sure you want to proceed?" icon="pi pi-exclamation-triangle"/>
						</p:commandButton>
						
			    		<h:message for="synchSystemStatButton" id="synchSystemStatMessage" styleClass="w3-pale-red w3-border w3-padding"/>
			    		<!-- not supported for now -->	
			    		<!-- <p:commandButton action="#{systemInfo.synchForumStats}" icon="fa fa-refresh" 
			    			value="Synchronize Forum Statistics" update=":systemStatForm"/> -->
		    		</h:panelGrid>	
		    	</h:form>
			</p:fieldset>
			 
			 <p/>
			 
			<p:fieldset id="commentIndexFieldset" legend="Comment Search Index" toggleable="true" collapsed="true">
				
				<h:form id="commentIndexForm">
					
					<p:commandButton value="Re-index Comment Data" icon="pi pi-refresh" id="synchCommentIndexButton" styleClass="ui-button-raised ui-button-flat"
						action="#{systemInfo.synchCommentIndex}" widgetVar="synchCommentIndexVar" update=":commentIndexForm"
						onclick="$(this).children('span').eq(0).addClass('pi-spin pi-spinner');PF('synchCommentIndexVar').disable();"
						oncomplete="$(this).children('span').eq(0).removeClass('pi-spin pi-spinner');PF('synchCommentIndexVar').enable();">
						
						<p:confirm type="popup" header="Confirmation" message="Are you sure you want to proceed?" icon="pi pi-exclamation-triangle"/>
					</p:commandButton>
					
					<h:message for="synchCommentIndexButton" id="synchCommentIndexMessage" styleClass="w3-pale-red w3-border w3-padding"/>
				</h:form>
				
			</p:fieldset>
		
			<p/>
			
			 <p:fieldset id="configuredProperties" legend="#{msg['configured.application.properties']}" toggleable="true" collapsed="true">
			 
			 	<h:form>

					<p:dataTable var="configuredProperty" value="#{systemInfo.applicationProperties}" style="margin: 0 auto;table-layout:fixed;word-wrap:break-word;"
						styleClass="borderless" widgetVar="configuredPropertiesTableVar" rowIndexVar="rowIndex" id="configuredPropertiesTable" reflow="true">
						
						<p:column sortBy="#{configuredProperty.key}" style="text-align:left;">
							<f:facet name="header">
								#{msg['key']}
							</f:facet>
							#{configuredProperty.key}
						</p:column>

						<p:column style="text-align:left;">
							<f:facet name="header">
								#{msg['value']}
							</f:facet>
							<b>#{configuredProperty.value}</b>
						</p:column>
						
					</p:dataTable>
			 	
			 	</h:form>
			 	
			 </p:fieldset>
			 
			 <p/>
			 
			 <p:fieldset id="serverInformation" legend="#{msg['server.system.properties']}" toggleable="true" collapsed="true">

				<h:form>
					<p:dataTable var="systemProperty" value="#{systemInfo.systemProperties}" style="margin: 0 auto;table-layout:fixed;word-wrap:break-word;"
						styleClass="borderless" widgetVar="systemPropertiesTableVar" rowIndexVar="rowIndex" id="systemPropertiesTable" reflow="true">
						
						<p:column sortBy="#{systemProperty.key}" style="text-align:left;">
							<f:facet name="header">
								#{msg['key']}
							</f:facet>
							#{systemProperty.key}
						</p:column>

						<p:column style="text-align:left;">
							<f:facet name="header">
								#{msg['value']}
							</f:facet>
							<b>#{systemProperty.value}</b>
						</p:column>
						
					</p:dataTable>
			 
				</h:form>
			 </p:fieldset>
		</div>
		
		<p:confirmPopup global="true">
            <p:commandButton value="#{msg['no']}" type="button" styleClass="ui-confirm-popup-no ui-button-flat"/>
            <p:commandButton value="#{msg['yes']}" type="button" styleClass="ui-confirm-popup-yes" />
        </p:confirmPopup>
		
	</ui:define>
	
</ui:composition>